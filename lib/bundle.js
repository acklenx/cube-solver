!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.cubeSolver=t()}(this,function(){"use strict";var e=[],t=function t(n){return 0===n||1===n?1:e[n]>0?e[n]:(e[n]=t(n-1)*n,e[n])},n=[],r=function(e,t){if(t>e)return 0;for(;e>=n.length;){var r=n.length,o=[];o[0]=1;for(var i=1,a=r-1;i<r;i+=1)o[i]=n[a][i-1]+n[a][i];o[r]=1,n.push(o)}return n[e][t]},o=function(e){var t=[],n=e.length-1;return function r(o,i){for(var a=0;a<e[i].length;a+=1){var u=o.slice(0);u.push(e[i][a]),i===n?t.push(u):r(u,i+1)}}([],0),t},i=function(e,t){return Math.floor(Math.random()*(t-e)+1)+e},a=function(e,t,n){for(var r=e[t],o=t;o<n;o+=1)e[o]=e[o+1];e[n]=r},u=function(e,t,n){for(var r=e[n],o=n;o>t;o-=1)e[o]=e[o-1];e[t]=r},s=function(e,t){for(var n=0,r=0;r<e.length-1;r+=1)n=t*n+e[r];return n},f=function(e,t,n){for(var r=[],o=0,i=t-2;i>=0;i-=1){var a=e%n;e=Math.floor(e/n),r[i]=a,o+=a}return r[t-1]=(n-o%n)%n,r},l=function(e){for(var t=0,n=e.length-1;n>0;n-=1)for(var r=n-1;r>=0;r-=1)e[r]>e[n]&&(t+=1);return t%2},c=function(e,n){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.length-1,u=0,s=1,f=[];if(o)for(var l=e.length-1;l>=0;l-=1)n.indexOf(e[l])>=0&&(i=Math.min(i,e[l]),u+=r(e.length-1-l,s),f.unshift(e[l]),s+=1);else for(var c=0;c<e.length;c+=1)n.indexOf(e[c])>=0&&(i=Math.min(i,e[c]),u+=r(c,s),f.push(e[c]),s+=1);for(var h=0,v=f.length-1;v>0;v-=1){for(var d=0;f[v]!==n[v];)a(f,0,v),d+=1;h=(v+1)*h+d}return t(n.length)*u+h},h=function(e,n,o){for(var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=t(n.length),s=Math.floor(e/a),f=e%a,l=[],c=0;c<o;c+=1)l.push(-1);for(var h=1;h<n.length;h+=1){var v=f%(h+1);for(f=Math.floor(f/(h+1));v>0;)u(n,0,h),v-=1}var d=n.length-1;if(i)for(var m=0;m<o;m+=1){var g=r(o-1-m,d+1);s-g>=0&&(l[m]=n[n.length-1-d],s-=g,d-=1)}else for(var b=o-1;b>=0;b-=1){var p=r(b,d+1);s-p>=0&&(l[b]=n[d],s-=p,d-=1)}return l},v={"":0,2:1,"'":2},d=function(e){return/^([FRUBLD][2']?\s*)+$/.test(e)},m=function(e){if(!d(e))throw new Error("Invalid algorithm provided to algorithm parser");var t=[];return e.match(/[FRUBLD][2']?/g).forEach(function(e){var n="FRUBLD".indexOf(e.charAt(0)),r=v[e.charAt(1)];t.push(3*n+r)}),t},g=function(e){var t="";return e.forEach(function(e){switch(t+=" ",t+="FRUBLD".charAt(Math.floor(e/3)),e%3){case 1:t+="2";break;case 2:t+="'"}}),t.trim()},b=[[1,8,5,9],[0,11,4,8],[1,2,3,0],[3,10,7,11],[2,9,6,10],[5,4,7,6]],p=[[1,0,4,5],[0,3,7,4],[0,1,2,3],[3,2,6,7],[2,1,5,6],[5,4,7,6]],T=function(e,t){var n=e.slice(0);n[t[0]]=e[t[t.length-1]];for(var r=1;r<t.length;r+=1)n[t[r]]=e[t[r-1]];return n},x=function(e,t,n){for(var r=e,o=n[Math.floor(t/3)],i=t%3,a=0;a<=i;a+=1)r=T(r,o);return r},M=function(e,t){return x(e,t,b)},y=function(e,t){return x(e,t,p)},P=function(e,t){var n=Math.floor(t/3),r=b[n],o=t%3,i=M(e,t);if((0===n||3===n)&&o%2==0)for(var a=0;a<4;a+=1)i[r[a]]=(i[r[a]]+1)%2;return i},w=function(e,t){var n=Math.floor(t/3),r=p[n],o=t%3,i=y(e,t);if(2!==n&&5!==n&&o%2==0)for(var a=0;a<4;a+=1)i[r[a]]=(i[r[a]]+(a+1)%2+1)%3;return i},z=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},E=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),I=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},O=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},D=function(e,t,n){return function(r,o){var i=e(r);return i=t(i,o),n(i)}},k=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],V=function(){function e(t){var n=this;if(z(this,e),this.name=t.name,this.size=t.size,this.defaultIndex=t.defaultIndex||0,this.solvedIndexes=t.solvedIndexes||[this.defaultIndex],this.doMove=function(e,r){return t.doMove?t.doMove(n.table,e,r):n.table[e][r]},t.table)this.table=t.table;else{var r=D(t.getVector,t.cubieMove,t.getIndex);this.createMoveTable(t.size,r,t.moves)}}return E(e,[{key:"createMoveTable",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k;this.table=[];for(var r=0;r<e;r+=1)this.table.push([]);for(var o=0;o<e;o+=1)for(var i=0;i<n.length;i+=1){var a=n[i];if(!this.table[o][a]){var u=t(o,a),s=a-a%3*2+2;this.table[o][a]=u,this.table[u][s]=o}}}}]),e}(),F=function(e){return new V({name:e.name,moves:e.moves,defaultIndex:c([0,1,2,3,4,5,6,7],e.affected,e.reversed),size:e.size||t(8)/t(8-e.affected.length),getVector:function(t){return h(t,e.affected.slice(),8,e.reversed)},cubieMove:y,getIndex:function(t){return c(t,e.affected,e.reversed)}})},R=function(e){return new V({name:e.name,moves:e.moves,defaultIndex:c([0,1,2,3,4,5,6,7,8,9,10,11],e.affected,e.reversed),size:e.size||t(12)/t(12-e.affected.length),getVector:function(t){return h(t,e.affected.slice(),12,e.reversed)},cubieMove:M,getIndex:function(t){return c(t,e.affected,e.reversed)}})},U=function(e,t,n){for(var r=[],o=Math.pow(n,t-1),i=Math.pow(n,t-e.length-1),a=0;a<o&&r.length<i;a+=1)!function(o){var i=f(o,t,n);e.every(function(e){return 0===i[e]})&&r.push(o)}(a);return r},S=function(e){return new V({name:e.name,size:2048,solvedIndexes:U(e.affected,12,2),getVector:function(e){return f(e,12,2)},cubieMove:P,getIndex:function(e){return s(e,2)}})},j=function(e){return new V({name:e.name,size:2187,solvedIndexes:U(e.affected,8,3),getVector:function(e){return f(e,8,3)},cubieMove:w,getIndex:function(e){return s(e,3)}})},L=function(){function e(t,n){z(this,e),this.computePruningTable(t,n)}return E(e,[{key:"setPruningValue",value:function(e,t){this.table[e>>3]^=(15^t)<<((7&e)<<2)}},{key:"getPruningValue",value:function(e){return this.table[e>>3]>>((7&e)<<2)&15}},{key:"computePruningTable",value:function(e,t){var n=e.reduce(function(e,t){return e*t.size},1);this.table=[];for(var r=0;r<n+7>>3;r+=1)this.table.push(-1);for(var i=0,a=0,u=[1],s=1;s<e.length;s+=1)u.push(e[s-1].size*u[s-1]);for(var f=o(e.map(function(e){return e.solvedIndexes})),l=0;l<f.length;l+=1){for(var c=0,h=0;h<f[l].length;h+=1)c+=u[h]*f[l][h];this.setPruningValue(c,0),a+=1}for(;a!==n;){var v=a>n/2,d=v?15:i,m=v?i:15;i+=1;for(var g=0;g<n;g+=1)if(this.getPruningValue(g)===d)for(var b=0;b<t.length;b+=1){for(var p=t[b],T=g,x=0,M=u.length-1;M>=0;M-=1)x+=u[M]*e[M].doMove(Math.floor(T/u[M]),p),T%=u[M];if(this.getPruningValue(x)===m){if(a+=1,v){this.setPruningValue(g,i);break}this.setPruningValue(x,i)}}}}}]),e}(),_=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],C=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_;z(this,e),this.createTables=t,this.moves=n}return E(e,[{key:"initialize",value:function(){var e=this;this.initialized=!0;var t=this.createTables(),n=t.moveTables,r=t.pruningTables;this.moveTables=n,this.pruningTables=[],r.forEach(function(t){var n=t.map(function(t){return e.moveTables.map(function(e){return e.name}).indexOf(t)});n.sort(function(t,n){return e.moveTables[t].size-e.moveTables[n].size});var r=[];n.forEach(function(t){return r.push(e.moveTables[t])});var o=new L(r,e.moves);e.pruningTables.push({pruningTable:o,moveTableIndexes:n})})}},{key:"handleSolution",value:function(e,t){return{solution:e,indexes:t}}},{key:"search",value:function(e,t,n,r){for(var o=0,i=0;i<this.pruningTables.length;i+=1){for(var a=e[this.pruningTables[i].moveTableIndexes[0]],u=1,s=1;s<this.pruningTables[i].moveTableIndexes.length;s+=1)u*=this.moveTables[this.pruningTables[i].moveTableIndexes[s-1]].size,a+=e[this.pruningTables[i].moveTableIndexes[s]]*u;var f=this.pruningTables[i].pruningTable.getPruningValue(a);if(f>t)return!1;f>o&&(o=f)}if(0===o)return this.handleSolution(r,e);if(t>0)for(var l=0;l<this.moves.length;l+=1){var c=this.moves[l];if(Math.floor(c/3)!==Math.floor(n/3)&&Math.floor(c/3)!==Math.floor(n/3)-3){for(var h=[],v=0;v<e.length;v+=1)h.push(this.moveTables[v].doMove(e[v],c));var d=this.search(h,t-1,c,r.concat([c]));if(d)return d}}return!1}},{key:"solve",value:function(e){var t=this;this.initialized||this.initialize(),this.settings=Object.assign({maxDepth:22,lastMove:null,format:!0},e);var n=this.settings.indexes||[];if(this.settings.scramble){for(var r=m(this.settings.scramble),o=0;o<this.moveTables.length;o+=1)n.push(this.moveTables[o].defaultIndex);r.forEach(function(e){for(var r=0;r<n.length;r+=1)n[r]=t.moveTables[r].doMove(n[r],e)})}for(var i=0;i<=this.settings.maxDepth;i+=1){var a=this.search(n,i,this.settings.lastMove,[]);if(a)return this.settings.format?g(a.solution):a}return!1}}]),e}(),A=[1,10,4,13,6,7,8,15,16,17],B=void 0,$=void 0,q=void 0,G=void 0,H=new C(function(){G=[];for(var e=0;e<336;e+=1){G.push([]);for(var t=0;t<336;t+=1)G[e][t]=function(e,t){for(var n=h(e,[0,1,2],12),r=h(t,[3,4,5],12),o=0;o<8;o+=1)if(-1!==n[o]){if(-1!==r[o])return-1;r[o]=n[o]}return c(r,[0,1,2,3,4,5])}(e,t)}return{moveTables:[new V({name:"slicePermutation",size:24,table:q.table}),B,$,R({name:"URToDF",size:20160,moves:A,affected:[0,1,2,3,4,5]})],pruningTables:[["slicePermutation","parity","URFToDLF"],["slicePermutation","parity","URToDF"]]}},A),J=new(function(e){function t(){var e;z(this,t);for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];var i=O(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r)));return i.maxDepth=22,i.solution=null,i}return I(t,C),E(t,[{key:"handleSolution",value:function(e,t){var n=e.slice(-1)[0];if(n%2==0&&6===Math.floor(n/3)&&15===Math.floor(n/3))return!1;var r=H.solve({indexes:[t[3],t[4],t[5],G[t[6]][t[7]]],maxDepth:this.maxDepth-e.length,lastMove:n,format:!1});if(r){if(this.solution=e.concat(r.solution),this.maxDepth<=this.settings.maxDepth)return{solution:this.solution,indexes:t};this.maxDepth=this.solution.length-1}return!1}}]),t}())(function(){return B=new V({name:"parity",size:2,table:[[1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1],[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0]]}),$=F({name:"URFToDLF",affected:[0,1,2,3,4,5]}),q=R({name:"slice",affected:[8,9,10,11],reversed:!0}),H.initialize(),{moveTables:[new V({name:"slicePosition",size:495,table:q.table,doMove:function(e,t,n){return Math.floor(e[24*t][n]/24)}}),j({name:"twist",affected:[0,1,2,3,4,5,6,7]}),S({name:"flip",affected:[0,1,2,3,4,5,6,7,8,9,10,11]}),q,B,$,R({name:"URToUL",affected:[0,1,2]}),R({name:"UBToDF",affected:[3,4,5]})],pruningTables:[["slicePosition","flip"],["slicePosition","twist"]]}}),K=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:22;return Array.isArray(e)?J.solve({indexes:e,maxDepth:t}):J.solve({scramble:e,maxDepth:t})},N=new C(function(){return{moveTables:[R({name:"EdgePermutation",affected:[4,5,6,7]}),S({name:"EdgeOrientation",affected:[4,5,6,7]})],pruningTables:[["EdgePermutation"],["EdgeOrientation"]]}}),Q=new C(function(){return{moveTables:[S({name:"EdgeOrientation",affected:[6,9,10]}),j({name:"CornerOrientation",affected:[5,6]}),R({name:"EdgePermutation",affected:[6,9,10]}),F({name:"CornerPermutation",affected:[5,6]})],pruningTables:[["EdgeOrientation","CornerPermutation"],["CornerOrientation","CornerPermutation"],["EdgePermutation","CornerPermutation"]]}}),W=new C(function(){return{moveTables:[S({name:"EdgeOrientation",affected:[0,1,2,3,4,5,6,7,8,9,10,11]}),R({name:"EdgePermutation",affected:[5,7]})],pruningTables:[["EdgeOrientation"],["EdgePermutation"]]}});return{solve:K,getRandomScramble:function(){var e=void 0,t=void 0,n=void 0,r=void 0;do{e=f(i(0,2048),12,2),n=f(i(0,2187),8,3),t=h(i(0,479001600),[0,1,2,3,4,5,6,7,8,9,10,11],12),r=h(i(0,40320),[0,1,2,3,4,5,6,7],8)}while(l(t)!==l(r));var o=[Math.floor(c(t,[8,9,10,11],!0)/24),s(n,3),s(e,2),c(t,[8,9,10,11],!0),l(r),c(r,[0,1,2,3,4,5]),c(t,[0,1,2]),c(t,[3,4,5])];return K(o)},crossSolver:function(e){return N.solve({scramble:e})},firstBlockSolver:function(e){return Q.solve({scramble:e})},EOLineSolver:function(e){return W.solve({scramble:e})}}});
